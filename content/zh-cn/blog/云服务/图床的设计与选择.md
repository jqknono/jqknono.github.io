---
layout: blog
title: 图床的设计与选择
linkTitle: 图床的设计与选择
published: false
categories: 未分类
tags: [未分类, 云服务]
date: 2024-06-28 15:46:17 +0800
draft: true
toc: true
toc_hide: false
math: false
comments: false
giscus_comments: true
hide_summary: false
hide_feedback: false
description: 
weight: 100
---

- [ ] 图床的设计与选择

## 什么是图床

简而言之，图床是用来存储和管理博客或网站所需图片资源的远程服务器。

## 为什么使用图床

图床的使用可以极大地提高网站访问速度，解耦文章和图片，同时降低服务器压力。在文章内容的组织形式和博客架构上，使用图床能够更好地管理图片资源，提升用户体验。

**用图床和不用图床的本质区别是什么, 是否仅有速度上的区别?**

**如果租用的服务器宽带足够, 是否可以不使用图床?**

其实更大的影响在于 markdown 文件和图片的耦合度存在差异. 即文章内容的组织形式, 博客的架构上存在差异.

不使用图床时, 图片和 markdown 文件是耦合在一起的, 图片的管理和使用基于**相对路径**,
使用图床后, 图片的管理和使用都是在远程服务器上进行, 本地只是引用图片的链接, 是一种绝对路径的使用方法.

绝对路径在大多数时候都是更好的选择, 它可以保证图片的可用性. 如果使用相对路径, 当 markdown 文件和图片任一路径发生变化时, 引用关系即被破坏.

使用相对路径引用图片的博客更难重构, 难以维护, 也更难分享到更多平台. 我们在网上常看见各种图片已失效的文章, 多数属于文章和引用文件间的关联未处理好.

## 图床如何加速网站的访问

通常个人网站租用的服务器宽带有限, 以我常年购买的服务器为例, 固定带宽不超过 **5Mbps**, 每秒传输速度仅 **600KB**, 假使在文章中存在两张 **3MB** 的图片, 那么加载时间就会超过 **10 秒**.

**我们需要理解, 没有多少人可以等待一个网页加载 10 秒.**

**如何解决加载缓慢的问题?**

可以使用`lazy-load`方式, 先加载文章, 再加载图片, 这样访问者不必等待一个空白页面, 而是可以直接开始看文章, 图片加载后再看图片.  
这只是应对网速慢的一种权宜之计, 很多人甚至不会在一个简短的网页上停留超过 **10 秒**, 传输图片占用的网速没有传递有效信息, 因为后加载的图片并没有被看到.

更直接的解决加载慢的办法就是增加宽带, 但是宽带的成本很高, 阿里云 **1000Mbps** 一天的租用费用超过 **6000 元**, 一个月的费用超过 **18w**, 这对于个人网站来说是不可承受的.

各平台除了固定带宽以外, 还提供了按流量计费的方式, 国内的云服务商按流量计费的价格在 **0.5 元/GB** 到 **1 元/GB** 之间, 10Mbps 或 1Tbps 费用相同, 我们可以选择最大带宽以提供最大的访问速度.

这里要注意的是按流量计费是后付费, 如果网站被攻击, 资源被大量请求下载, 后果也非常严重, 存在破产的可能. 消耗流量的攻击方式过于简单, 以至于很难防范.

我的家用**带宽 1Tb** 一个月才 200 元 不到, 很容易就可以消耗服务器大量流量, 对攻击者来说成本接近为 0.

我们可以自行配置图片服务, 配置 nginx, 限制特定 ip 的访问频次, 限制多媒体文件的访问场景, 自行剪裁压缩图片, 以减少流量消耗, 这些都需要消耗时间, 这些配置不复杂, 但是需要消耗一些时间.

第三方图床是专门用来存储图片的, 通常会提供 CDN(内容分发网络) 服务, CDN 可以加速图片的传输, 降低图片的加载时间, 也可以减少服务器的压力.

因此, 我更推荐图床服务. 第三方图床服务通常会提供更多的功能, 比如图片压缩, 图片裁剪, 图片水印等, 这些功能可以帮助我们更好的管理图片, 也可以帮助我们更好的展示图片.

## 如何选择图床

图床有**第三方**和**自建**两种方式, 第三方图床根据使用方式有**专用图床**和**通用存储**之分. 简单的**专用图床**可以直接上传图片, 然后获取图片链接, 比如[sm.ms](https://sm.ms/),
[imgur](https://imgur.com/)等, 复杂的**通用存储**则会提供更多的功能, 比如阿里云 oss, 腾讯云 cos 等, **通用存储**顾名思义, 可以存储任何文件, 通常会提供更多的功能, 比如图片压缩, 图片裁剪, 图片水印等.
有的甚至提供图片审核, 图片识别等功能.

需要考虑一些维度, 比如*访问体验*, _文章撰写体验_, _应对变化_, *应对攻击*等方面, 根据这些维度选择图床.

读者可以根据图床的以下几个维度来决定是自建图床还是使用第三方图床.

### 写作体验

有的图床需要在网页手动上传图片, 这是最差的体验, 一个不提供 API 上传的图床, 会让你在写作时, 需要打开网页, 上传图片, 然后复制链接, 它会打断你的创作, 降低你的写作效率.
因此, 我们最好选择一个提供 API 的图床, 这样我们可以在写作时, 通过快捷键上传图片, 无需打断写作.

这里推荐一个开源免费的图片上传工具[picgo](https://picgo.github.io/PicGo-Doc/en/guide/), 它支持多种图床, 也支持自定义图床, 你可以选择一个适合自己的图床, 通过快捷键上传图片.

除了 api 上传以外, 如果是自建图床, 使用 ftp/webdav 上传也是较为方便的.

### 访问体验

图床在提供服务时, 为了更好的体验, 还需要使用 CDN(内容分发网络), CDN 可以加速图片的传输, 降低图片的加载时间.  
自建 CDN 难度较大, 成本较高, 需要谨慎考虑.  
由于政策的原因, 部分服务商的 CDN 网络在国内可能有限制, 实际体验需要自行测试.

### 费用

费用主要有三部分:

- 存储
- 服务器流量/带宽
- **CDN 流量**

一个访问较多的服务真正跑起来后, 主要的费用在 CDN 流量上, 因此我们主要考虑 CDN 的单价.

以阿里云为例, 入门价格是 0.24 元/GB, 流量超大时有优惠, 但是绝大多数个人和企业都达不到, 不多赘述.

### 避免破产

这一节的内容是安全相关, 为了让读者重视, 我将标题写为避免破产.

被攻击的主要形式就是以 DDoS 攻击的形式消耗 CDN 流量, 简单来说就是调用大量的设备, 大量的请求资源, 以往的 DoS 攻击的结果是服务器宕机, 正常用户无法访问服务,
但当使用 CDN 后, 服务很难宕机, 但是流量消耗会很大, 造成费用的增加, 我在论坛看到有人购买的 60TB 流量在一周内被消耗完, 你需要相信一个服务只要被公开, 就一定会被攻击.
就我看到的各个服务商的收费模式, 都是后付费模式, 用多少就扣多少钱, 这是一个需要重点关注的风险.

如何避免被攻击, 有的服务商具有自己处理攻击的能力, 比如`cloudflare`, 非常的省心. 而有的服务商提供一些安全性设置, 但默认并不会启用, 读者需要自行开启.

安全性设置大致包括:

- 限制 reffer, 请求图片时必须是从指定的网站跳转过来的, 甚至可以限制无 reffer 的请求
- 限制 agent, 请求图片时必须是指定的浏览器, 可以避免 curl 等工具的请求

这是阿里云 OSS 的安全性设置, 读者可以参考.

![](https://s2.loli.net/2024/05/16/48JxCrzVY3diPes.png)

以上措施实际上只能**防盗窃**, 不能防攻击, 攻击者还是可以很容易的构造攻击请求去消耗你的流量.

OSS 高防才是真正的安全保护, 但是阿里云的价格非常离谱, 这本应该作为公共 OSS 的免费赠送服务.

![](https://s2.loli.net/2024/05/16/snC2fYNGIFepHVT.png)

防 DDoS 收费过于离谱, 要么是阿里云的技术能力有限, 要么是产品经理脑子没想清楚.

这里我就不推荐阿里云来做图床了, 因为它实质上没有提供可用的保护能力, 所谓的数据安全能力, 只能"防君子不防小人".

## 结论

首先, 随着博客站点的进化, 迟早都会了解图床这个概念, 尽早使用图床解耦文章和图片好处明显.

在图床的选择上, 考虑以下几点:

- 上传 API
- 提供合适速度 CDN
- 提供 DDoS 保护

基于这几点我主要推荐[sm.ms](https://smms.app/)的服务, 免费就已经足够大多数用户使用, 虽然速度很慢.

## 参考

- [推荐工具 picgo](https://github.com/Molunerfinn/PicGo/releases)
- [一些图床集合](https://zhuanlan.zhihu.com/p/58863378)
